#!/usr/bin/env node

const Cass          = require('./cass')
const {ModuleList}  = require('./cass/canvas-modules')
const {getArgs}     = require('./cass/util/args')
const {MatchAny}    = require('./cass/util/matchers')
const {par_foreach} = require('./cass/util/async')

async function main() {
  const patterns = getArgs({min: 1, usage: 'PATTERN...+'})
  const matcher  = new MatchAny(patterns, 'i')
  const cass     = new Cass
  const canvas   = cass.canvas()
  const modlist  = await new ModuleList(cass).load()

  const promises = []

  for (const mod of modlist.getModules())
    if (matcher.test(mod.name))
      promises.push(mod.uncreate())

  return Promise.all(promises)
}

main().then(_ => 0, console.log)
