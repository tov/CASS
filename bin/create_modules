#!/usr/bin/env node

const {argv}        = require('process')
const fs            = require('fs/promises')

const Cass          = require('./cass')
const {ModuleList}  = require('./cass/canvas-modules')
const {getArgs}     = require('./cass/util/args')
const {MatchAny}    = require('./cass/util/matchers')
const {seq_foreach} = require('./cass/util/async')

async function main() {
  const patterns = getArgs({min: 1, usage: 'PATTERN...+'})
  const matcher  = new MatchAny(patterns, 'i')
  const cass     = new Cass
  const canvas   = cass.canvas()
  const modlist  = await new ModuleList(cass).load()

  for (const mod of modlist.getModules())
    if (matcher.test(mod.name))
      await mod.create()
}

main().then(_ => 0, console.log)
