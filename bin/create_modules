#!/usr/bin/env node

const Cass          = require('./cass')
const {MatchAnyArg} = require('./cass/util/matchers')
const {ModuleList}  = require('./cass/canvas-modules')
const fs            = require('fs/promises')

const matcher       = new MatchAnyArg

const maybeCreate = canvas => async module => {
  if (matcher.test(module.name()))
    await module.create()
}

async function main() {
  const cass     = new Cass
  const canvas   = cass.canvas()
  const modules  = await fs.readFile(cass.base('modules.json'), 'utf8')
  const promises = ModuleList.fromJSON(cass, modules).map(maybeCreate(canvas))
  await Promise.all(promises)
}

main().then(_ => 0, console.log)
